#!/bin/sh

/home/y/bin64/mysql -e "select c.managing_entity_id as network_id, (select replace(d.name,',','') from entity d where d.id = c.managing_entity_id) as network_name,c.id as advertiser_id,replace(c.name,',','') as advertiser_name,a.creative_id,a.created_on,(-1 * timestampdiff(HOUR,NOW(),a.created_on)) as age_in_hours from creative_media_guard_queue a, creative b, entity c where a.creative_id = b.id and a.audit_done_stage = '0' and b.advertiser_entity_Id = c.id and b.is_deleted =  0 and a.source_queue = 'trading_pit' and timestampdiff(HOUR,NOW(),a.created_on) between -744 and 0 order by 1,7 desc" trf_prod --batch --silent > creatives_trading_pit_pending_queue.csv

/home/y/bin64/mysql -e "select f.network_id,replace(f.network_name,',','') as network_name,f.bucket_interval as sla_bucket_hours,f.bucket_count as pending_count from (select network_id,network_name,1 as orderseq,'0-6 Hours' as bucket_interval,count(*) as bucket_count from (select  c.managing_entity_id as network_id, (select d.name from entity d where d.id = c.managing_entity_id) as network_name from creative_media_guard_queue a, creative b, entity c where a.creative_id = b.id and a.audit_done_stage = '0'and b.advertiser_entity_Id = c.id and b.is_deleted =  0 and a.source_queue = 'trading_pit' and timestampdiff(HOUR,NOW(),a.created_on) between -6 and 0) a group by network_id,network_name union select network_id,network_name,2 as orderseq,'6-12 Hours' as bucket_interval,count(*) as bucket_count from (select  c.managing_entity_id as network_id, (select d.name from entity d where d.id = c.managing_entity_id) as network_name from creative_media_guard_queue a, creative b, entity c where a.creative_id = b.id and a.audit_done_stage = '0' and b.advertiser_entity_Id = c.id and b.is_deleted = 0 and a.source_queue = 'trading_pit' and timestampdiff(HOUR,NOW(),a.created_on) between -12 and -7) b group by network_id,network_name union select network_id,network_name,3 as orderseq,'12-18 Hours' as bucket_interval,count(*) as bucket_count from (select  c.managing_entity_id as network_id, (select d.name from entity d where d.id = c.managing_entity_id) as network_name from creative_media_guard_queue a, creative b, entity c where a.creative_id = b.id and a.audit_done_stage = '0' and b.advertiser_entity_Id = c.id and b.is_deleted = 0 and a.source_queue = 'trading_pit' and timestampdiff(HOUR,NOW(),a.created_on) between -18 and -13) c group by network_id,network_name union select network_id,network_name,4 as orderseq,'18-24 Hours' as bucket_interval,count(*) as bucket_count from (select  c.managing_entity_id as network_id, (select d.name from entity d where d.id = c.managing_entity_id) as network_name from creative_media_guard_queue a, creative b, entity c where a.creative_id = b.id and a.audit_done_stage = '0' and b.advertiser_entity_Id = c.id and b.is_deleted = 0 and a.source_queue = 'trading_pit' and timestampdiff(HOUR,NOW(),a.created_on) between -24 and -19) d group by network_id,network_name union select network_id,network_name,5 as orderseq,'24+ Hours' as bucket_inverval,count(*) as bucket_count from ( select  c.managing_entity_id as network_id, (select d.name from entity d where d.id = c.managing_entity_id) as network_name from creative_media_guard_queue a, creative b, entity c where a.creative_id = b.id and a.audit_done_stage = '0' and b.advertiser_entity_Id = c.id and a.source_queue = 'trading_pit' and b.is_deleted = 0 and timestampdiff(HOUR,NOW(),a.created_on) between -744 and -25 ) d group by network_id,network_name)f order by network_name,orderseq desc" trf_prod --batch --silent >  network_pending_queue_buckets.csv



